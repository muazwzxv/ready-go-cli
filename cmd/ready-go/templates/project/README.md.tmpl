# {{.ProjectName}}

{{.Description}}

## Features

- ğŸ—ï¸ Clean Architecture (Entity, DTO, Repository, Service, Handler layers)
- âš™ï¸ Simple Configuration (Viper with automatic environment override)
- ğŸ³ Docker & Docker Compose setup
- ğŸ—„ï¸ MySQL database with sqlx
- ğŸ” Type-safe SQL queries with sqlc
- ğŸŒ Fiber v2 web framework
- âœ… Health check endpoints
- ğŸ”’ Middleware (logging, error handling, CORS)
- ğŸ“¦ Sample CRUD API for {{.SampleAPIName}}

## Prerequisites

- Go {{.GoVersion}} or higher
- Docker and Docker Compose
- Make (optional, for convenience commands)
- sqlc (for SQL code generation) - `go install github.com/sqlc-dev/sqlc/cmd/sqlc@latest`

## Quick Start

### Using Docker Compose (Recommended)

1. Start all services:
```bash
make up
```

2. Run database migrations:
```bash
make migrate-up
```

3. Generate sqlc code (type-safe SQL queries):
```bash
make sqlc-generate
```

4. Access the application:
- API: http://localhost:{{.AppPort}}
- Health Check: http://localhost:{{.AppPort}}/health
{{if .WithKafka}}
- Kafka UI: http://localhost:{{.KafkaUIPort}}
{{end}}

### Local Development

1. Start only the database services:
```bash
docker-compose up -d mysql{{if .WithRedis}} redis{{end}}{{if .WithKafka}} kafka{{end}}
```

2. Run the application:
```bash
make run
```

## Configuration

The application uses **Viper** for simple, powerful configuration management with automatic environment variable override.

### Configuration Priority

**Environment Variables â†’ TOML File**

(Environment variables have the highest priority)

### Environment Variables

Environment variables automatically override config file values. Nested keys are flattened with underscores:

```bash
# Server configuration
export SERVER_HOST=0.0.0.0
export SERVER_PORT={{.AppPort}}
export SERVER_READ_TIMEOUT=5s
export SERVER_WRITE_TIMEOUT=10s

# Database configuration
export DATABASE_HOST=localhost
export DATABASE_PORT={{.MySQLPort}}
export DATABASE_USER=appuser
export DATABASE_PASSWORD=apppassword
export DATABASE_DATABASE={{.ProjectName}}
export DATABASE_MAX_OPEN_CONNS=50
export DATABASE_MAX_IDLE_CONNS=20
```

**Environment variable naming convention:**
- Uppercase with underscores
- Nested keys are flattened: `server.host` â†’ `SERVER_HOST`
- Examples:
  - `server.port` â†’ `SERVER_PORT`
  - `database.max_open_conns` â†’ `DATABASE_MAX_OPEN_CONNS`

See `.env.example` for all available options.

### TOML Configuration File

Edit `config.toml` for structured configuration:

```toml
[server]
host = "0.0.0.0"
port = {{.AppPort}}
read_timeout = "5s"
write_timeout = "10s"

[database]
host = "localhost"
port = {{.MySQLPort}}
user = "appuser"
password = "apppassword"
database = "{{.ProjectName}}"
max_open_conns = 25
max_idle_conns = 10
conn_max_lifetime = "5m"
```

The configuration file is **optional**. If not present, the application will use environment variables only.

## API Endpoints

### Health Check
- `GET /health` - Basic health check
- `GET /health/ready` - Readiness check (includes database status)

### {{.SampleAPIName}} API
- `GET /api/v1/{{.SampleTableName}}` - List all {{.SampleTableName}} (paginated)
- `POST /api/v1/{{.SampleTableName}}` - Create a new {{.SampleAPINameLower}}
- `GET /api/v1/{{.SampleTableName}}/:id` - Get {{.SampleAPINameLower}} by ID
- `PUT /api/v1/{{.SampleTableName}}/:id` - Update {{.SampleAPINameLower}}
- `DELETE /api/v1/{{.SampleTableName}}/:id` - Delete {{.SampleAPINameLower}}

## Development

### Available Make Commands

```bash
make help           # Show all available commands
make up             # Start all services
make down           # Stop all services
make logs           # Show logs from all services
make build          # Build the application
make run            # Run the application locally
make migrate-up     # Run database migrations
make migrate-down   # Rollback last migration
make migrate-status # Check migration status
make migrate-create # Create new migration (use NAME=migration_name)
make sqlc-generate  # Generate Go code from SQL queries
make test           # Run tests
make clean          # Stop services and remove volumes
```

### Database Operations

#### Migrations

Create a new migration:
```bash
make migrate-create NAME=add_users_table
```

Run migrations:
```bash
make migrate-up
```

Rollback:
```bash
make migrate-down
```

Check migration status:
```bash
make migrate-status
```

#### Type-Safe SQL with sqlc

This project uses [sqlc](https://sqlc.dev/) to generate type-safe Go code from SQL queries. SQL queries are written in `internal/database/query/` and sqlc generates corresponding Go functions.

**Generate Code:**
```bash
make sqlc-generate
```

**Workflow:**

1. Write your SQL queries in `internal/database/query/*.sql`:
```sql
-- name: Get{{.SampleAPIName}}ByID :one
SELECT * FROM {{.SampleTableName}} WHERE id = ?;

-- name: Create{{.SampleAPIName}} :execresult
INSERT INTO {{.SampleTableName}} (name, description, status)
VALUES (?, ?, ?);
```

2. Run code generation:
```bash
make sqlc-generate
```

3. Use the generated type-safe functions in your repository:
```go
import "{{.ModuleName}}/internal/database/store"

queries := store.New()
{{.SampleAPINameLower}}, err := queries.Get{{.SampleAPIName}}ByID(ctx, db, id)
```

**Benefits:**
- âœ… Compile-time type safety for SQL queries
- âœ… Auto-generated models from database schema
- âœ… No manual struct mapping
- âœ… Catches SQL errors at build time

The generated code is located in `internal/database/store/` and is automatically created from:
- Schema: `internal/database/migrations/*.sql`
- Queries: `internal/database/query/*.sql`

## Project Structure

```
{{.ProjectName}}/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go              # Application entry point
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/                  # Viper-based configuration
â”‚   â”œâ”€â”€ database/                # Database setup & migrations
â”‚   â”‚   â”œâ”€â”€ migrations/         # SQL migration files
â”‚   â”‚   â”œâ”€â”€ query/              # SQL queries for sqlc
â”‚   â”‚   â”œâ”€â”€ store/              # Generated sqlc code
â”‚   â”‚   â”œâ”€â”€ database.go         # Database connection
â”‚   â”‚   â””â”€â”€ sqlc.yaml           # sqlc configuration
â”‚   â”œâ”€â”€ entity/                  # Domain models
â”‚   â”œâ”€â”€ dto/                     # Data Transfer Objects
â”‚   â”‚   â”œâ”€â”€ request/            # API request structures
â”‚   â”‚   â””â”€â”€ response/           # API response structures
â”‚   â”œâ”€â”€ repository/              # Data access layer
â”‚   â”œâ”€â”€ service/                 # Business logic layer
â”‚   â”œâ”€â”€ handler/                 # HTTP handlers
â”‚   â””â”€â”€ application.go           # Application wiring
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â””â”€â”€ config.toml
```

## Technology Stack

- **Web Framework**: [Fiber v2](https://gofiber.io/)
- **Database**: MySQL {{.MySQLVersion}} with [sqlx](https://github.com/jmoiron/sqlx)
- **Type-Safe SQL**: [sqlc](https://sqlc.dev/) for compile-time SQL validation
- **Configuration**: [Viper](https://github.com/spf13/viper) with TOML + Environment Variables
{{if .WithRedis}}
- **Cache**: Redis {{.RedisVersion}}
{{end}}
{{if .WithKafka}}
- **Message Queue**: Apache Kafka {{.KafkaVersion}}
{{end}}
- **Migrations**: [goose](https://github.com/pressly/goose)

## Deployment

### Docker

Build the Docker image:
```bash
make docker-build
```

Run with Docker:
```bash
docker run -p {{.AppPort}}:{{.AppPort}} --env-file .env.docker {{.ProjectName}}:latest
```

### Production Checklist

- [ ] Update database credentials
- [ ] Configure proper logging
- [ ] Set up monitoring and alerting
- [ ] Enable HTTPS/TLS
- [ ] Configure rate limiting
- [ ] Set up backup strategy
- [ ] Review security headers

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License.

## Author

{{if .Author}}{{.Author}}{{else}}Your Name{{end}}

---

**Generated with [ready-go-cli](https://github.com/muazwzxv/ready-go-cli)**
